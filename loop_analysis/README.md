# Loop Analysis (左心室 開・閉ループ判定)

心エコー動画の各フレームに対し、左心室壁が途切れずに閉じているか（Closed Loop）、開いているか（Open Loop）を時系列で解析・判定します。

## ファイル構成
- **`sixvideo_research.py`**: 複数の動画を一括で解析し、Accuracy/F1-score等の精度評価を行うスクリプト。
- **`echo_loop.py`**: 単体の動画を解析し、判定結果をオーバーレイした動画を出力するスクリプト。

## 判定ロジック
1. **領域限定:** 扇形マスクにより、超音波描出領域外のノイズを除去。
2. **前処理:** 平滑化およびモルフォロジー演算（クロージング）により、軽微な壁の途切れを修復。
3. **階層解析:** `cv2.findContours` で輪郭の階層構造を取得。
   - 「深度1（最外郭の内側）」にある輪郭の面積が `area_thr` を超えている場合、「Close（閉ループ）」と判定します。

## パラメータ説明 (`PARAMS`)
各スクリプト内の `PARAMS` 辞書にて定義されています。

| パラメータ | 説明 | デフォルト値 |
| --- | --- | --- |
| `threshold` | 二値化しきい値 | 20 |
| `iterations` | モルフォロジー演算（クロージング）の回数 | 4 |
| `area_thr` | 閉ループとみなす最小面積しきい値 | 2600 |
| `open_boundary_slope` | 開ループ判定用の境界線の傾き係数 | 6.0 |

## 実行方法
プロジェクトルートから以下のように実行します。

```bash
# 1. 単体動画の解析と可視化（結果動画が出力されます）
python loop_analysis/echo_loop.py "path/to/video.mp4"

# 2. 複数動画の一括解析（スクリプト内のリスト対象）
cd loop_analysis
python sixvideo_research.py