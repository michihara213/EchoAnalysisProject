# Left Ventricle Detection (左心室検出)

AIモデルによるセグメンテーション結果と、画像処理による幾何学的推定結果（2次関数フィッティング）を比較し、左心室が解剖学的に正しく描出されているかを判定するモジュールです。

## ファイル構成
- **`lv_research.py`**: 動画リストを読み込み、フレームごとに判定を行ってCSVを出力するメインスクリプト。
- **`lv_segment.py`**: Kerasモデルを用いたAIセグメンテーション処理。
- **`lv_geometry.py`**: OpenCVを用いた幾何学的領域推定。

## 判定ロジック
1. **AI検出:** [echo-plax-segmentation](URL) の学習済みモデルを用いて左心室マスク ($A_{ai}$) を生成。
2. **幾何学的推定:** 扇形フィルタ、二値化、輪郭抽出を経て、点群に対して2次関数フィッティングを行い、内部領域 ($A_{geo}$) を定義。
3. **一致率判定:** 2つの領域の面積比率 $R$ を計算。
   $$R = \frac{\min(A_{ai}, A_{geo})}{\max(A_{ai}, A_{geo})}$$
   $R > 0.8$ (デフォルト閾値) の場合、「検出 (Detected)」と判定します。

## パラメータ説明 (`lv_geometry.py`)
`PARAMS` 辞書にて解析条件を調整可能です。

| パラメータ | 説明 | デフォルト値 |
| --- | --- | --- |
| `blur_ksize` | 平滑化カーネルサイズ（ノイズ除去） | 21 |
| `threshold` | 二値化しきい値 | 120 |
| `min_area` | 検出対象とする最小面積 | 300 |
| `pos_ratio` | 探索範囲のY座標制限（画面上部何%以下か） | 0.45 |
| `fan_center` | 扇形の中心座標 (x, y) | (315, 62) |

## 実行方法
プロジェクトルートから以下のように実行します。

```bash
# モデルパスを指定して実行
python lv_analysis/lv_research.py --model "models/mymodel_segmentation.h5"